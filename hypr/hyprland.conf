################################################################################
# hyprland.conf — complete translation of your Sway config into Hyprland
# - Single file
# - Uses tofi, kitty, hyprlock, mako, hyprpaper, grim+slurp, etc.
# - Submaps implement Sway modes
# - Preserves Emacs clock commands and script hooks
#
# Save as: ~/.config/hypr/hyprland.conf
################################################################################

# -------------------------
# MONITOR (generic)
# -------------------------
monitor=,preferred,auto,1

# -------------------------
# ENV / AUTOSTART
# -------------------------
# run once commands on startup
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = mako                       # notification daemon
exec-once = hyprpaper                  # wallpaper daemon (assumed installed)
exec-once = mpd
exec-once = swaync                     # keeps your swaync service (assume hypr-compatible)
exec-once = ~/.config/scripts/wallpaper.sh --set
exec-once = ~/.config/scripts/lowbattery.sh
exec-once = tmux new -s init -d
exec-once = wl-paste --watch cliphist store
exec-once = sh -c "xhost +SI:localuser:$(id -un)"
exec-once = sh -c "xhost +SI:localuser:root"
exec-once = touch /tmp/tasks
exec-once = gsettings set org.gtk.Settings.FileChooser window-size '(1200, 700)'
exec-once = gsettings set org.gnome.desktop.interface font-name 'Iosevka'
exec-once = gsettings set org.gnome.desktop.interface color-scheme 'prefer-dark'
exec-once = gsettings set org.gnome.desktop.interface gtk-theme "Gruvbox-Dark-BL"
exec-once = emacs --daemon
exec-once = sh -c "cd ~/projects/repos/dashboard && uv run main.py & disown"
exec-once = /usr/lib/xdg-desktop-portal-wlr  -l DEBUG
exec-once = /usr/lib/xdg-desktop-portal --verbose -r
exec-once = aw-qt || true
exec-once = aw-watcher-window-wayland-git || true

# open todo at start like your sway config
exec-once = emacsclient -c ~/projects/notes/todo.org

# notify that config reloaded (on reload)
exec = notify-send "Hyprland" "config reloaded"

# -------------------------
# INPUT (keyboard / touchpad / tablet)
# replicate Sway input blocks -> Hyprland input
# -------------------------
input {
    # layouts: first listed is the binds/default layout (hyprland quirk)
    kb_layout = us,in
    kb_variant =
    kb_options = caps:escape, grp:win_space_toggle
    # repeat values (ms / repeats) — Hyprland supports these keys
    repeat_delay = 200
    repeat_rate = 30

    follow_mouse = 0                     # focus_follows_mouse no -> 0

    touchpad {
        natural_scroll = false          # Sway had natural_scroll disabled for touchpad
    }

    "type:keyboard" {
        # Hyprland doesn't support typed input blocks named exactly like Sway
        # but common fields exist; keep behavior consistent with the top-level keys
    }

    sensitivity = 0.0
}

# -------------------------
# DECORATIONS (no rounding, no blur)
# -------------------------
decoration {
    rounding = 0
}

# -------------------------
# GENERAL / LAYOUT SETTINGS
# -------------------------
general {
    layout = dwindle
    gaps_in = 0
    gaps_out = 0
    border_size = 1                  # default_border pixel 1
}

misc {
    focus_on_activate = true
    vfr = true
}

animations {
    enabled = true
    bezier = ease, 0.1, 0.9, 0.2, 1.0
    animation = windows, 1, 3, ease
    animation = workspaces, 1, 3, ease
}

# -------------------------
# VARIABLES (small set to reuse)
# -------------------------
$mod = SUPER
$alt = ALT
$left = h
$down = j
$up = k
$right = l
$term = kitty --single-instance
$editor = nvim
$menu = tofi-drun --prompt 'Run:'  # original used xargs swaymsg exec — we'll call tofi and exec commands after selection

# Emacs clock commands (preserved)
$emacs_clock_in = emacsclient -eval "(org-clock-in-last)"
$emacs_clock_out = emacsclient -eval "(org-clock-out)"

# -------------------------
# WINDOW RULES (converted from for_window { ... } blocks)
# -------------------------
# Many Sway 'for_window' rules map to Hyprland 'windowrulev2' lines.
# Note: Hyprland `windowrulev2` syntax accepts comma-separated flags (float, center, etc.)
# Example: windowrulev2 = float,class:(kitty),title:(some)
windowrulev2 = float,class:(Thunar)
windowrulev2 = float,class:(zenity)
windowrulev2 = float,class:(vpn),size:950x550
windowrulev2 = center,class:(vpn),size:950x550
windowrulev2 = float,class:(ncmpcpp)
windowrulev2 = float,class:(org.kde.kdeconnect.daemon)
windowrulev2 = float,title:(Imgmenu),size:1080x400
windowrulev2 = center,class:(Monkeytype),title:(Monkeytype)

# Notes:
# - Some 'title' / 'app_id' regexes were converted to class or title patterns.
# - Hyprland centering after toggling float is known to be inconsistent in older versions; if you see odd behavior,
#   adding explicit move/center scripts can help. See Hyprland issues & wiki. :contentReference[oaicite:3]{index=3}

# -------------------------
# KEYBINDINGS (main binds converted)
# -------------------------
# basic open/kill/menu/term
bind = $mod, RETURN, exec, $term
bind = $mod, q, killactive,
# Launch menu: Sway used piping through swaymsg exec — with Hyprland we just run tofi and have it launch apps
bind = $mod, d, exec, $menu
bind = $mod, z, exec, sh -c "tofi-run --prompt 'Run:' | xargs -r sh -c"    # approximation: pipe chosen command to shell

# floating modifier (Sway: floating_modifier $mod normal)
# Hyprland: hold SUPER by default for dragging/resizing with mouse: provide binds below
# reload / restart
bind = $mod CONTROL, c, exit,   # Hyprland has 'close' or 'exit'; we map to exit (restart is not always exposed)
# media keys
bind = , XF86AudioPlay, exec, mpc toggle
bind = $mod CONTROL, l, exec, hyprlock -i ~/Pictures/wp/defaultwp.jpg  # emulate swaylock behavior with hyprlock (image)
# focus with hjkl and arrow variants
bind = $mod, h, movefocus, l
bind = $mod, j, movefocus, d
bind = $mod, k, movefocus, u
bind = $mod, l, movefocus, r
bind = $mod, Left, movefocus, l
bind = $mod, Down, movefocus, d
bind = $mod, Up, movefocus, u
bind = $mod, Right, movefocus, r

# move by "30" px steps — Hyprland movewindow takes directions, not px by default; we'll implement both coarse and single-step:
# coarse (approx) — use movewindow with px offsets via exec helper script
bind = $mod SHIFT, h, exec, hyprctl dispatch movewindow -10 -0 || movewindow l
bind = $mod SHIFT, j, exec, hyprctl dispatch movewindow 0 10 || movewindow d
bind = $mod SHIFT, k, exec, hyprctl dispatch movewindow 0 -10 || movewindow u
bind = $mod SHIFT, l, exec, hyprctl dispatch movewindow 10 0 || movewindow r

# arrow variants without px:
bind = $mod SHIFT, Left, movewindow, l
bind = $mod SHIFT, Down, movewindow, d
bind = $mod SHIFT, Up, movewindow, u
bind = $mod SHIFT, Right, movewindow, r

# workspaces (some named)
bind = $mod, 1, workspace, 1
bind = $mod, 2, workspace, 2
bind = $mod, 3, workspace, 3
bind = $mod, b, workspace, b
bind = $mod, m, workspace, m
bind = $mod, 8, workspace, d
bind = $mod, 9, workspace, 9
bind = $mod, 0, workspace, 10

# move container to workspace
bind = $mod SHIFT, 1, movetoworkspace, 1
bind = $mod SHIFT, 2, movetoworkspace, 2
bind = $mod SHIFT, 3, movetoworkspace, 3
bind = $mod SHIFT, e, movetoworkspace, e
bind = $mod SHIFT, b, movetoworkspace, b
bind = $mod SHIFT, m, movetoworkspace, m
bind = $mod SHIFT, 8, movetoworkspace, d
bind = $mod SHIFT, 9, movetoworkspace, 9
bind = $mod SHIFT, 0, movetoworkspace, 10

bind = $mod, f, fullscreen,
bind = $mod SHIFT, space, togglefloating,

# workspace back_and_forth -> hyprland 'workspace back_and_forth' supported
bind = $mod, n, workspace, back_and_forth

# audio keys map to amixer and showstuff script
bind = , XF86AudioMute, exec, amixer set Master toggle && ~/.config/scripts/showstuff vol alsa
bind = , XF86AudioLowerVolume, exec, amixer set Master 5%- && ~/.config/scripts/showstuff vol alsa
bind = , XF86AudioRaiseVolume, exec, amixer set Master 2%+ && ~/.config/scripts/showstuff vol alsa
bind = $mod SHIFT, d, exec, amixer set Master 5%- && ~/.config/scripts/showstuff vol alsa
bind = $mod SHIFT, u, exec, amixer set Master 2%+ && ~/.config/scripts/showstuff vol alsa

# brightness keys
bind = , XF86MonBrightnessDown, exec, brightnessctl set 5%- 
bind = , XF86MonBrightnessUp, exec, brightnessctl set +5% 

# screenshots
bind = , Print, exec, sh -c 'slurp | xargs -I{} grim -g "{}" ~/Pictures/Screenshots/screenshot_$(date +%Y-%m-%d-%H%M%S).png'
bind = $mod, Print, exec, ~/.config/scripts/copy_with_tesseract
bind = Shift, Print, exec, ~/.local/bin/grimshot copy area
bind = $mod SHIFT, Print, exec, ~/.local/bin/grimshot copy active

# swaync controls
bind = $mod, Backspace, exec, swaync-client -C
bind = $mod SHIFT, Backspace, exec, swaync-client -t -sw

# set_time script mapping
bind = $mod SHIFT, Return, exec, sh -c "~/.config/scripts/set_time 0 && hyprctl dispatch workspace 1 && $emacs_clock_out"

# sticky toggle (approx)
bind = $mod CONTROL, s, exec, sh -c "hyprctl dispatch togglefloating"    # approximation of sticky

# display output controls (enable/disable)
bind = $mod CONTROL, 1, exec, hyprctl dispatch output eDP-1 enable
bind = $mod CONTROL, 2, exec, hyprctl dispatch output eDP-1 disable
bind = $mod CONTROL, 3, exec, hyprctl dispatch output HDMI-A-1 enable
bind = $mod CONTROL, 4, exec, hyprctl dispatch output HDMI-A-1 disable

# ------------ modes / submaps ------------
# We'll create submaps for 'script', 'timer_map', 'layout', 'yank', 'resize', 'focus', 'mark', 'gotomark', 'open', 'timer_map', 'script'
# Hyprland submap syntax: bind = <MOD>, <KEY>, submap, <name>  then define 'submap = <name>' section

# ----- SCRIPT MODE (matches your Sway mode "script") -----
bind = $mod, s, submap, script
submap = script
    bind = , r, exec, ~/.config/scripts/mode/sway-refile-to-workspace && submap, reset
    bind = , c, exec, ~/.config/scripts/mode/sway-launch-with-slurp foot && submap, reset
    bind = , m, exec, ~/.config/scripts/mpd.sh & disown && submap, reset
    bind = , p, exec, ~/.config/scripts/power.sh && submap, reset
    bind = , s, exec, ~/.config/scripts/dmenu_term.sh -e ~/.config/scripts && submap, reset
    bind = , h, exec, bluetoothctl connect 88:0E:85:39:E6:9C && submap, reset
    bind = $mod, Print, exec, ~/.config/scripts/screenshot.sh && submap, reset
    bind = $mod, p, exec, ~/.config/scripts/passmenu.sh && submap, reset
    bind = $mod, t, submap, timer_map
    bind = $mod SHIFT, t, exec, ~/.config/scripts/set_time 0 && submap, reset
    bind = $mod, n, exec, ~/.config/scripts/bookman.sh -nw --open && submap, reset
    bind = $mod, b, exec, ~/.config/scripts/bookman.sh --open && submap, reset
    bind = $mod, v, exec, ~/.config/scripts/mpv.sh && submap, reset
    bind = $mod, q, exec, ~/.config/scripts/power.sh && submap, reset
    bind = $mod, w, exec, ~/.config/scripts/wallpaper.sh --select && submap, reset
    bind = $mod, i, exec, ~/.config/scripts/wallpaper.sh --file "$(~/projects/repos/imgmenu/venv/bin/python ~/projects/repos/imgmenu/main.py)" && submap, reset
    bind = $mod, y, submap, yank
    bind = $mod, e, exec, ~/.config/scripts/emoji.sh && submap, reset
    bind = , v, exec, sed -i ~/.config/sway/config -e "s/^\(\s*\)xkb_options caps:escape/" && submap, reset
    bind = , e, exec, sed -i ~/.config/sway/config -e "s/^\(\s*\)xkb_options caps:escape/" && submap, reset
    bind = , Return, submap, reset
    bind = , Escape, submap, reset
    bind = , d, exec, ~/projects/repos/dashboard/main.py & disown && submap, reset
    bind = , i, exec, ~/.config/scripts/pastable.sh && submap, reset
    bind = Shift, n, exec, mpc next && submap, reset
    bind = Shift, p, exec, mpc prev && submap, reset
submap = reset

# ----- TIMER MAP -----
submap = timer_map
    bind = , s, exec, ~/.config/scripts/set_time 1 && submap, reset
    bind = , t, exec, ~/.config/scripts/timer.sh && submap, reset
    bind = , Escape, submap, reset
submap = reset

# ----- YANK MODE (clipboard helpers) -----
bind = $mod, y, submap, yank
submap = yank
    bind = , p, exec, ~/.config/scripts/passmenu.sh && submap, reset
    bind = , c, exec, ~/.config/scripts/cliphist.sh 2> /tmp/log && submap, reset
    bind = , b, exec, ~/.config/scripts/bookman.sh --yank && submap, reset
    bind = , q, exec, ~/.config/scripts/power.sh && submap, reset
    bind = , e, exec, ~/.config/scripts/dmenu_term.sh -p & disown && submap, reset
    bind = , s, exec, ~/.config/scripts/dmenu_term.sh -e ~/.config/scripts && submap, reset
    bind = , Return, submap, reset
    bind = , Escape, submap, reset
submap = reset

# ----- RESIZE MODE (approx Sway 'resize' mode) -----
bind = $mod, r, submap, resize
submap = resize
    bind = , h, exec, hyprctl dispatch resizeactive -20 0 && submap, reset
    bind = , j, exec, hyprctl dispatch resizeactive 0 20 && submap, reset
    bind = , k, exec, hyprctl dispatch resizeactive 0 -20 && submap, reset
    bind = , l, exec, hyprctl dispatch resizeactive 20 0 && submap, reset
    bind = , Return, submap, reset
    bind = , Escape, submap, reset
submap = reset

# ----- FOCUS MODE (approximates Sway focus mode) -----
bind = $mod, x, submap, focus
submap = focus
    # embedded block of many binds (we keep to core ones)
    bind = $mod, l, movefocus, r
    bind = $mod, n, workspace, back_and_forth
    bind = $mod, h, movefocus, l
    bind = $mod, j, movefocus, d
    bind = $mod, k, movefocus, u
    bind = $mod, d, exec, $menu
    bind = $mod, q, killactive,
    bind = $mod SHIFT, Return, exec, ~/.config/scripts/set_time 0 && exec, $emacs_clock_out && submap, reset
    bind = $mod, f, fullscreen,
    # scratchpad show: emulate by a dedicated workspace "__scratchpad"
    bind = $mod SHIFT, s, togglespecialworkspace
    bind = $mod SHIFT, i, movetoworkspace, special
    bind = $mod CONTROL, i, movetoworkspace, special
    bind = , Escape, submap, reset
submap = reset

# ----- OPEN MODE (app quick-launch workspace mapping) -----
bind = $mod, o, submap, open
submap = open
    bind = , e, exec, hyprctl dispatch workspace e && submap, reset
    bind = , d, exec, ~/.config/scripts/mode/sway-goto-if-not-start "d" "Discord" vesktop && submap, reset
    bind = , f, exec, ~/.config/scripts/mode/sway-goto-if-not-start "b" "Zen Browser" "zen-browser" && submap, reset
    bind = , h, exec, ~/.config/scripts/mode/sway-goto-if-not-start "c" "chess" "/usr/bin/chromium --app=\"https://chess.com/play\"" && submap, reset
    bind = , m, exec, ~/.config/scripts/mode/sway-goto-if-not-start "mail" "inbox" "/usr/bin/chromium --app=\"https://gmail.com\"" && submap, reset
    bind = , t, exec, ~/.config/scripts/mode/sway-goto-if-not-start "typing" "monkeytype" "chromium --app=\"https://monkeytype.com\"" && submap, reset

    bind = , a, exec, chromium --new-window --app="https://chatgpt.com" && submap, reset
    bind = , s, exec, chromium --new-window --app="https://chat.deepseek.com" && submap, reset
    bind = , p, exec, chromium --new-window --app="https://perplexity.ai" && submap, reset
    bind = , l, exec, chromium --new-window --app="https://claude.ai" && submap, reset
    bind = , k, exec, chromium --new-window --app="https://grok.com" && submap, reset
    bind = , g, exec, chromium --new-window --app="https://gemini.google.com/app" && submap, reset
    bind = , y, exec, chromium --new-window --app="https://youtube.com" && submap, reset

    bind = , n, exec, $term -e ~/.local/bin/checkemacs -nw && submap, reset
    bind = , b, exec, thunar && submap, reset
    bind = , c, exec, chromium && submap, reset
    bind = $mod, c, exec, emacsclient -c ~/projects/notes/org/todo.org && submap, reset
    bind = , w, exec, firefox && submap, reset

    bind = , Return, submap, reset
    bind = , Escape, submap, reset
submap = reset

# -------------------------
# Bindings that close or move workspaces between outputs
# -------------------------
bind = $mod CONTROL, Left, exec, hyprctl dispatch moveworkspace tooutput left
bind = $mod CONTROL, Right, exec, hyprctl dispatch moveworkspace tooutput right

# scratchpad behavior approximations:
# We emulate a scratchpad workspace called __scratchpad
# Move window to scratchpad:
bind = $mod SHIFT, s, togglespecialworkspace
bind = $mod SHIFT, i, movetoworkspace, special
bind = $mod CONTROL, i, movetoworkspace, special

# bind for running arbitrary shell commands like Sway's 'mode shell-command'
bind = $mod SHIFT, q, exec, ~/.config/scripts/mode/shell-command


# -------------------------
# Additional exec-once for emacs clock integration (your Sway had a bind)
# - Map Sway bind: bindsym $mod+Shift+Control+f exec $emacs_clock_in; exec ~/.config/scripts/set_time 1; mode "focus"
# - In Hyprland we map it to run both commands and switch to the focus submap
# -------------------------
bind = $mod SHIFT CONTROL, f, exec, sh -c "$emacs_clock_in; ~/.config/scripts/set_time 1" && exec, notify-send "Emacs" "Clocked in"

